<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vocab Trainer</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --card: #ffffff;
      --text: #111111;
      --blue: #007BFF;
      --shadow: 0 20px 35px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; }
    body { display: flex; align-items: center; justify-content: center; }
    .counter { position: fixed; top: 20px; left: 20px; color: #fff; font-size: 18px; }
    .card { width: 300px; height: 200px; border-radius: 16px; box-shadow: var(--shadow); background: var(--card); display: flex; align-items: center; justify-content: center; cursor: pointer; perspective: 1000px; user-select: none; }
    .card-inner { width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.6s; position: relative; }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; border-radius: 16px; padding: 10px; text-align: center; }
    .card-face.back { transform: rotateY(180deg); color: var(--blue); }
    .fab { position: fixed; bottom: 20px; width: 50px; height: 50px; border-radius: 50%; background: #fff; box-shadow: var(--shadow); display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
    .fab.add { right: 20px; }
    .fab.manage { right: 80px; }
    dialog { border: none; border-radius: 12px; padding: 16px; max-width: 400px; }
    input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; }
    .btn { background: #fff; border: 1px solid #ccc; padding: 8px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
    ul { list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; }
    li { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #ccc; }
    li button { background: #ff4d4d; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="counter" id="counter">Words: 0</div>
  <div class="card" id="card">
    <div class="card-inner">
      <div class="card-face front" id="front">Add your first word</div>
      <div class="card-face back" id="back">Ajoutez votre premier mot</div>
    </div>
  </div>
  <div class="fab manage" id="manageBtn">−</div>
  <div class="fab add" id="addBtn">＋</div>

  <!-- Add Word Modal -->
  <dialog id="addModal">
    <h3>Add a Word</h3>
    <input type="text" id="enWord" placeholder="English" />
    <input type="text" id="frWord" placeholder="French" />
    <button id="saveWord">Save</button>
    <hr>
    <textarea id="bulkInput" rows="4" placeholder="apple,pomme\nbook,livre"></textarea>
    <button id="bulkAdd">Add Bulk</button>
    <hr>
    <button class="btn" id="importBtn">Import File</button>
    <button class="btn" id="exportBtn">Export CSV</button>
    <input type="file" id="fileInput" accept=".csv,.xlsx" style="display:none" />
    <br><br>
    <button id="closeModal">Close</button>
  </dialog>

  <!-- Manage Words Modal -->
  <dialog id="manageModal">
    <h3>Manage Words</h3>
    <ul id="wordList"></ul>
    <hr>
    <button class="btn" id="clearBtn">Clear All</button>
    <br><br>
    <button id="closeManage">Close</button>
  </dialog>

  <script>
    const LS_KEY = 'vocab.words';
    let words = JSON.parse(localStorage.getItem(LS_KEY)) || [];
    let current = null;
    let flipped = false;

    const card = document.getElementById('card');
    const front = document.getElementById('front');
    const back = document.getElementById('back');
    const counter = document.getElementById('counter');

    function save() { localStorage.setItem(LS_KEY, JSON.stringify(words)); }
    function randomWord() { return words[Math.floor(Math.random() * words.length)]; }
    function render() {
      if (!current) {
        front.textContent = 'Add your first word'; 
        back.textContent = 'Ajoutez votre premier mot'; 
        card.classList.remove('flipped'); 
      } else {
        front.textContent = current.english; 
        back.textContent = current.french;
        if (flipped) card.classList.add('flipped'); else card.classList.remove('flipped');
      }
      updateCounter();
    }
    function next() { flipped = false; current = words.length ? randomWord() : null; render(); }
    function updateCounter() { counter.textContent = `Words: ${words.length}`; }

    next();

    // Click to flip
    card.addEventListener('click', () => { flipped = !flipped; render(); });

    // Swipe detection (pointer events)
let isDragging = false;
let startX = 0, startY = 0;
let lastDx = 0;

card.addEventListener('pointerdown', e => {
  isDragging = true;
  startX = e.clientX;
  startY = e.clientY;
  lastDx = 0;
  card.setPointerCapture(e.pointerId);
  card.style.transition = ''; // cancel transitions while dragging
});

card.addEventListener('pointermove', e => {
  if (!isDragging) return;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;
  lastDx = dx;
  // soft rotation based on dx
  const rot = dx * 0.04;
  card.style.transform = `translateX(${dx}px) translateY(${dy*0.06}px) rotate(${rot}deg)`;
  // badges
  const alpha = Math.min(1, Math.abs(dx)/140);
  if (dx > 0){
    likeBadge.style.opacity = alpha;
    nopeBadge.style.opacity = 0;
  } else {
    nopeBadge.style.opacity = alpha;
    likeBadge.style.opacity = 0;
  }
});

function endDrag(e){
  if (!isDragging) return;
  isDragging = false;
  card.releasePointerCapture && card.releasePointerCapture(e.pointerId);
  likeBadge.style.opacity = 0;
  nopeBadge.style.opacity = 0;

  const dx = lastDx;
  const threshold = 110;
  if (Math.abs(dx) > threshold){
    // animate out then reset and show next
    const dir = Math.sign(dx);
    card.style.transition = 'transform 260ms ease-out, opacity 260ms ease-out';
    card.style.transform = `translateX(${dir*900}px) rotate(${dir*18}deg)`;
    card.style.opacity = '0.25';
    setTimeout(()=>{
      card.style.transition = '';
      card.style.transform = '';
      card.style.opacity = '';
      nextWord();
    }, 260);
  } else {
    // reset
    card.style.transition = 'transform 220ms cubic-bezier(.2,.9,.3,1)';
    card.style.transform = '';
    setTimeout(()=> card.style.transition = '', 240);
  }
}

card.addEventListener('pointerup', endDrag);
card.addEventListener('pointercancel', endDrag);
// aussi couvrir mouseleave (si drag à la souris)
card.addEventListener('mouseleave', (e)=> { if (isDragging) endDrag(e); });


    // Add Modal
    const addBtn = document.getElementById('addBtn');
    const addModal = document.getElementById('addModal');
    const enWord = document.getElementById('enWord');
    const frWord = document.getElementById('frWord');
    const saveWord = document.getElementById('saveWord');
    const bulkInput = document.getElementById('bulkInput');
    document.getElementById('closeModal').onclick = () => addModal.close();
    addBtn.onclick = () => addModal.showModal();

    saveWord.onclick = () => {
      const en = enWord.value.trim(), fr = frWord.value.trim();
      if (!en || !fr) return;
      words.push({ english: en, french: fr }); 
      save(); 
      enWord.value = frWord.value = ''; 
      if (!current) next(); 
      render();
    };

    document.getElementById('bulkAdd').onclick = () => {
      bulkInput.value.split(/\n+/).forEach(line => {
        const [en, fr] = line.split(',');
        if (en && fr) words.push({ english: en.trim(), french: fr.trim() });
      });
      save(); 
      bulkInput.value = ''; 
      if (!current) next(); 
      render();
    };

    // Import / Export
    document.getElementById('importBtn').onclick = () => document.getElementById('fileInput').click();
    document.getElementById('fileInput').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => {
        const data = new Uint8Array(evt.target.result);
        const wb = XLSX.read(data, { type: 'array' });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        rows.forEach(r => { if (r[0] && r[1]) words.push({ english: r[0], french: r[1] }); });
        save(); 
        if (!current) next(); 
        render();
      };
      reader.readAsArrayBuffer(file);
    };

    document.getElementById('exportBtn').onclick = () => {
      const csv = 'english,french\n' + words.map(w => `${w.english},${w.french}`).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'vocab.csv'; a.click();
    };

    // Manage Modal
    const manageBtn = document.getElementById('manageBtn');
    const manageModal = document.getElementById('manageModal');
    const wordList = document.getElementById('wordList');
    const closeManage = document.getElementById('closeManage');
    const clearBtn = document.getElementById('clearBtn');

    manageBtn.onclick = () => { renderWordList(); manageModal.showModal(); };
    closeManage.onclick = () => manageModal.close();

    clearBtn.onclick = () => {
      words = [];
      save();
      next();
      renderWordList();
    };

    function renderWordList() {
      wordList.innerHTML = '';
      words.forEach((w, i) => {
        const li = document.createElement('li');
        li.innerHTML = `${w.english} - ${w.french} <button data-index="${i}">Delete</button>`;
        wordList.appendChild(li);
      });
      wordList.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', e => {
          const index = parseInt(e.target.dataset.index);
          words.splice(index, 1);
          save();
          next();
          renderWordList();
        });
      });
      updateCounter();
    }
  </script>
</body>
</html>

